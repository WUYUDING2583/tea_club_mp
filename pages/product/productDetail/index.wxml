<!--pages/product/productDetail/index.wxml-->
<wxs src="../../tool.wxs" module="tool" />
<view class='cu-custom'>
  <view class="cu-bar fixed bg-shadeTop" style="height:{{CustomBar}}px;padding-top:{{StatusBar}}px;">
    <navigator class='action' open-type="navigateBack" delta="1" hover-class="none">
      <text class='cuIcon-back'></text> 返回
    </navigator>
    <view class='content' style='top:{{StatusBar}}px;'>{{byProducts[productId].name}}</view>
  </view>
</view>
<scroll-view scroll-y="{{!showModal}}" style="height:100vh;">
  <swiper class="screen-swiper round-dot" indicator-dots="true" circular="true" autoplay="true" interval="5000" duration="500">
    <swiper-item wx:for="{{byProducts[productId].photos}}" wx:key="unique">
      <image src="{{byProductPhotos[item]}}" mode='aspectFill'></image>
    </swiper-item>
  </swiper>
  <view id="content" class="padding bg-white">
    <view id="price" class="margin-bottom-sm">
      <text class="text-red text-xl" wx:if="{{byProducts[productId].price.ingot>0}}">{{byProducts[productId].price.ingot}}元宝 </text>
      <text class="text-red text-xl" wx:if="{{byProducts[productId].price.credit>0}}">{{byProducts[productId].price.credit}}积分</text>
    </view>
    <view id="activity" class="margin-bottom">
      <view class="cu-tag bg-red light sm round margin-right" wx:for="{{byProducts[productId].activityRules}}" wx:key="unique">
        <text wx:if="{{byActivityRules[item].activityRuleType.uid==3}}">{{byActivityRules[item].activityRule1}}%折扣</text>
        <text wx:if="{{byActivityRules[item].activityRuleType.uid==2}}">消费满{{byActivityRules[item].activityRule1}}元宝{{byActivityRules[item].activityRule2.operation=="plus"?"赠":"减"}}{{byActivityRules[item].activityRule2.number}}{{byActivityRules[item].activityRule2.currency=="ingot"?"元宝":"积分"}}</text>
      </view>
    </view>
    <view id="description" style="width:100vw" class="flex margin-bottom ">
      <view class="text-xl flex-wrap text-black text-bold" style="word-wrap:break-word; word-break:break-all;flex:8">{{byProducts[productId].description}}</view>
      <view style="flex:2;" class="text-df">
        <button class="cu-btn bg-gray text-grey round" style="width:20vw" open-type='share'>
          <text class="cuIcon-share"></text>分享
        </button>
      </view>
    </view>
    <view class="flex">
      <view class="flex-sub text-grey text-center">
        <text class="cuIcon-shop"></text>库存{{byProducts[productId].storage}}</view>
      <view class="flex-sub text-grey text-center">
        <text class="cuIcon-cascades"></text>月销{{byProducts[productId].sales==null?0:byProducts[productId].sales}}</view>
    </view>
  </view>
  <view id="activity-detail" class="cu-bar bg-white solid-bottom margin-top" wx:if="{{byProducts[productId].activityRules.length>0}}">
    <view class='action'>
      <text class='cuIcon-titles text-orange '></text> 活动详情
    </view>
  </view>
  <view class="cu-list menu">
    <view class="cu-item arrow" wx:for="{{byProducts[productId].activityRules}}" wx:key="unique" bindtap="showModal" data-target="activityCustomer" data-id="{{byProducts[productId].activityRules[index]}}">
      <view class="content">
        <!-- <text>{{byActivityRules[item].activityRuleType.name}}</text> -->
        <view wx:if="{{byActivityRules[item].activityRuleType.uid==3}}">
          <text class="cuIcon-recharge text-red margin-right"></text>{{byActivityRules[item].activityRule1}}%折扣</view>
        <view wx:if="{{byActivityRules[item].activityRuleType.uid==2}}">
          <text class="cuIcon-redpacket text-red margin-right"></text>消费满{{byActivityRules[item].activityRule1}}元宝{{byActivityRules[item].activityRule2.operation=="plus"?"赠":"减"}}{{byActivityRules[item].activityRule2.number}}{{byActivityRules[item].activityRule2.currency=="ingot"?"元宝":"积分"}}</view>
      </view>
      <view class="action">
        <text class="text-grey text-sm">适用客户</text>
      </view>
    </view>
  </view>
  <view id="product-detail" class="cu-bar bg-white solid-bottom margin-top">
    <view class='action'>
      <text class='cuIcon-titles text-orange '></text> 产品详情
    </view>
  </view>
  <view class="cu-list menu margin-bottom-xl">
    <image wx:for="{{byProducts[productId].productDetails}}" wx:key="unique" src="{{byProductPhotos[item]}}" />
  </view>
</scroll-view>
<view class="cu-bar bg-white tabbar border shop" style="position:fixed;bottom:0;width:100vw;">
  <navigator hover-class="none" url="../../cart/index">
    <view class="action">
      <view class="cuIcon-cart">
        <view class="cu-tag badge" wx:if="{{cartTotal>0}}">{{cartTotal}}</view>
      </view>
      购物车
    </view>
  </navigator>
  <view class="btn-group" style="width:calc(100vw-140rpx)">
    <button class="cu-btn bg-green round shadow-blur" style="width:40%" bindtap="showSelectModal" data-target="addToCart">加入购物车</button>
    <button class="cu-btn bg-blue round shadow-blur" style="width:40%" bindtap="showSelectModal" data-target="purchase">立即订购</button>
  </view>
</view>
<cu-bottom-modal show="{{showModal}}" bindhideModal="hideModal">
  <view wx:if="{{modalName=='activityCustomer'}}" class="margin-xl">
    <text wx:for="{{byActivityRules[ruleIndex].activityApplyForCustomerTypes}}" wx:key="unique">{{item.name}}</text>
  </view>
  <view wx:if="{{modalName=='select'}}">
    <view class="cu-card dynamic no-card">
      <view class="cu-item shadow">
        <view class="cu-list menu-avatar">
          <view class="cu-item">
            <view class="cu-avatar xl" style="background-image:url({{byProducts[productId].photo}});"></view>
            <view class="content flex-sub">
              <view>
                <text class="text-red text-xl" wx:if="{{byProducts[productId].price.ingot>0}}">{{byProducts[productId].price.ingot}}元宝 </text>
                <text class="text-red text-xl" wx:if="{{byProducts[productId].price.credit>0}}">{{byProducts[productId].price.credit}}积分</text>
              </view>
              <view class="text-gray text-sm flex justify-between">
                库存{{byProducts[productId].storage}}件
              </view>
            </view>
          </view>
        </view>
        <view class="cu-bar bg-white solid-bottom margin-top">
          <view class="action">
            <text class="cuIcon-title text-orange "></text> 购买数量
          </view>
          <view class="action margin-right" style="width:50vw">
            <cu-stepper min="0" max="{{byProducts[productId].storage}}" bindchange="changeNumber" number="{{number}}"></cu-stepper>
          </view>
        </view>
      </view>
    </view>
    <view class="flex padding justify-center">
      <button class="cu-btn bg-blue round lg" style="width:80vw" bindtap="confirm">
        <text class="cuIcon-loading2 iconfont-spin" wx:if="{{updateRequestQuantity>0}}"></text>确定</button>
    </view>
  </view>
</cu-bottom-modal>