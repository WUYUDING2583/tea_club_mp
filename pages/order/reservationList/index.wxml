<!--pages/order/reservationList/index.wxml-->
<wxs src="../../tool.wxs" module="tool" />
<import src="./template.wxml" />
<cu-custom bgColor="bg-gradual-blue" isBack="{{true}}">
  <view slot="backText">返回</view>
  <view slot="content">我的预约</view>
</cu-custom>


<view class="swiper-tab fixed" style="top:{{CustomBar}}px;">
  <view class="bre swiper-tab-list {{tab==0 ? 'on' : ''}}" data-current="0" bindtap="tab_click">待付款</view>
  <view class="swiper-tab-list {{tab==1 ? 'on' : ''}}" data-current="1" bindtap="tab_click">待进行</view>
  <view class="swiper-tab-list {{tab==2 ? 'on' : ''}}" data-current="2" bindtap="tab_click">已完成</view>
  <view class="swiper-tab-list {{tab==3 ? 'on' : ''}}" data-current="3" bindtap="tab_click">退款</view>
</view>


<swiper current="{{tab}}" class="swiper-box" duration="300" style="height:calc(100vh - {{CustomBar}}px - 50px)" bindchange="tab_slide">
  <swiper-item>
    <scroll-view scroll-y style="height:100%;" bindscrolltolower="scrollToBottom">
      <view wx:for="{{reservationsUnpay}}" wx:key="unique">
        <template is="reservationCard" data="{{...byReservationsUnpay[item]}}"></template>
      </view>
      <view class="text-grey text-center padding-xl" style="height:100%;" wx:if="{{reservationsUnpay.length==0}}">
        <view class="cu-avatar xl round margin-top-xl">
          <view class="cuIcon-discover text-blue margin"></view>
        </view>
        <view class="text-lg margin">您没有相关的订单</view>
      </view>
      <view class="text-grey text-center" wx:elif="{{isBottom}}">没有啦.....</view>
    </scroll-view>
  </swiper-item>

  <swiper-item>
    <scroll-view scroll-y style="height:100%;" bindscrolltolower="scrollToBottom">
      <view wx:for="{{reservationsPayed}}" wx:key="unique">
        <template is="reservationCard" data="{{...byReservationsPayed[item]}}"></template>
      </view>
      <view class="text-grey text-center padding-xl" style="height:100%;" wx:if="{{reservationsPayed.length==0}}">
        <view class="cu-avatar xl round margin-top-xl">
          <view class="cuIcon-discover text-blue margin"></view>
        </view>
        <view class="text-lg margin">您没有相关的订单</view>
      </view>
      <view class="text-grey text-center" wx:elif="{{isBottom}}">没有啦.....</view>
    </scroll-view>
  </swiper-item>

  <swiper-item>
    <scroll-view scroll-y style="height:100%;" bindscrolltolower="scrollToBottom">
      <view wx:for="{{reservationsComplete}}" wx:key="unique">
        <template is="reservationCard" data="{{...byReservationsComplete[item]}}"></template>
      </view>
      <view class="text-grey text-center padding-xl" style="height:100%;" wx:if="{{reservationsComplete.length==0}}">
        <view class="cu-avatar xl round margin-top-xl">
          <view class="cuIcon-discover text-blue margin"></view>
        </view>
        <view class="text-lg margin">您没有相关的订单</view>
      </view>
      <view class="text-grey text-center" wx:elif="{{isBottom}}">没有啦.....</view>
    </scroll-view>
  </swiper-item>

  <swiper-item>
    <scroll-view scroll-y style="height:100%;" bindscrolltolower="scrollToBottom">
      <view wx:for="{{reservationsRefund}}" wx:key="unique">
        <template is="reservationCard" data="{{...byReservationsRefund[item]}}"></template>
      </view>
      <view class="text-grey text-center padding-xl" style="height:100%;" wx:if="{{reservationsRefund.length==0}}">
        <view class="cu-avatar xl round margin-top-xl">
          <view class="cuIcon-discover text-blue margin"></view>
        </view>
        <view class="text-lg margin">您没有相关的订单</view>
      </view>
      <view class="text-grey text-center" wx:elif="{{isBottom}}">没有啦.....</view>
    </scroll-view>
  </swiper-item>

</swiper>


<view class="cu-modal {{modalName=='cancelOrderModal'?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">取消订单</view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <view class="padding-xl">
      确认取消订单？
    </view>
    <view class="cu-bar bg-white justify-end">
      <view class="action flex justify-between" style="width:100%;">
        <button class="cu-btn line-green text-green" style="width:40%" bindtap="hideModal">取消</button>
        <button class="cu-btn bg-green margin-left" style="width:40%" bindtap="_cancelOrder">确定</button>
      </view>
    </view>
  </view>
</view>


<view class="cu-modal {{modalName=='refundOrderModal'?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">取消订单</view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <view class="padding-xl bg-white">
    确认取消订单？
    </view>
    <view class="cu-bar bg-white justify-end">
      <view class="action flex justify-between" style="width:100%;">
        <button class="cu-btn line-green text-green" style="width:40%" bindtap="hideModal">取消</button>
        <button class="cu-btn bg-green margin-left" style="width:40%" bindtap="_refund">确定</button>
      </view>
    </view>
  </view>
</view>


<view class="cu-modal {{modalName=='errModal'?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">余额不足</view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <view class="padding-xl">
      <view>{{errMsg}}</view>
      <view>是否充值？</view>
    </view>
    <view class="cu-bar bg-white flex justify-around ">
      <view class="action ">
        <button class="cu-btn line-green text-green" style="width:30vw;" bindtap="hideModal">取消</button>
        <view style="width:10vw;"></view>
        <button class="cu-btn bg-green " style="width:30vw;" bindtap="showModal" data-target="chargeModal">确定</button>
      </view>
    </view>
  </view>
</view>

<view class="cu-modal bottom-modal {{modalName=='chargeModal'?'show':''}}" bindtap="hideModal">
  <view class="cu-dialog" catchtap>
    <view class="cu-bar bg-white">
      <view class="action text-blue" bindtap="hideModal">取消</view>
      <view class="action text-green" bindtap="_charge">确定</view>
    </view>
    <view class="grid col-3 padding-sm">
      <view wx:for="{{checkbox}}" class="padding-xs" wx:key="{{index}}">
        <button class="cu-btn blue lg block {{item.checked?'bg-blue':'line-blue'}}" bindtap="ChooseCheckbox" data-value="{{item.value}}" style="width:30vw;">
          <input wx:if="{{item.name=='自定义'}}" placeholder="{{item.name}}" id="selfInputCharge" bindinput="chargeInput" type="number"></input>
          <text wx:else>{{item.name}}</text>
        </button>
      </view>
    </view>
  </view>
</view>


<view class="cu-modal {{modalName=='shopAddressModal'?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">门店地址</view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <view class="padding-xl">
      {{shopAddress}}
    </view>
  </view>
</view>

